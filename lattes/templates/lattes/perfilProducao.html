{% extends 'lattes/layout.html' %}

{% block head %}
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
{% endblock %}

{% block main %}
<div id="grid-main">
    <canvas id="ChartAno"></canvas>
    <canvas id="ChartBibligrafico"></canvas>
    <canvas id="ChartTecnico"></canvas>
    <canvas id="ChartArtistico"></canvas>
    <canvas id="ChartEvento"></canvas>
    <canvas id="ChartOrientacao"></canvas>
    <canvas id="chartjs-line" style=" height: 400px;"></canvas>
</div>
<script>
	document.addEventListener("DOMContentLoaded", function() {
        var ctx = document.getElementById('ChartAno');
        var chartAno = new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ anos }},
                datasets: [{
                    label: '# de Produção',
                    data: {{ totalAno }},
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                tooltips: {
                    callbacks: {
                        title: function (tooltipItems, data) {
                            return data.labels[tooltipItems[0].index]
                        }
                    }
                },
                title: { display: true, text: 'Distribuição de produção por ano' },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                        xAxes: [{
                            ticks: {
                                autoSkipPadding: 11,
                                maxRotation: 90,
                                minRotation: 0
                            }
                        }]
                }
            }
        });
        $("#ChartAno").click(
            function (event) {
                var activepoints = chartAno.getElementsAtEvent(event);
                if (activepoints.length > 0) {
                    var clickedIndex = activepoints[0]["_index"];
                    var ano = chartAno.data.labels[clickedIndex];
                    window.location.href = "{% url 'lattes:producoes' %}?ano__gte=" + ano + "&ano__lte=" + ano
                }
                else {
                }
            }
        );
	});
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const tipoBibligrafico = new Chart(document.getElementById('ChartBibligrafico'), {
            type: 'bar',
            data: {
                labels: {% autoescape off %}{{ tiposB }}{% endautoescape %},
                datasets: [{
                    label: '# de Produção',
                    data: {{ totalTipoB }},
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                title: { display: true, text: 'Distribuição por tipo de produção bibliográfico' },
            }
        });
        $("#ChartBibligrafico").click(
            function (event) {
                var activepoints = tipoBibligrafico.getElementsAtEvent(event);
                if (activepoints.length > 0) {
                    var clickedIndex = activepoints[0]["_index"];
                    var tipo = tipoBibligrafico.data.labels[clickedIndex];
                    window.location.href = "{% url 'lattes:producoes' %}?tipo__contains=" + tipo
                }
                else {
                }
            }
        );
    });
</script>
<script>
	document.addEventListener("DOMContentLoaded", function() {
		var tipoTecnico = new Chart(document.getElementById('ChartTecnico'), {
            type: 'bar',
            data: {
                labels: {% autoescape off %}{{ tiposT }}{% endautoescape %},
                datasets: [{
                    label: '# de Produção',
                    data: {{ totalTipoT }},
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                title: { display: true, text: 'Distribuição por tipo de produção técnica' },
            }
        });	
        $("#ChartTecnico").click(
            function (event) {
                var activepoints = tipoTecnico.getElementsAtEvent(event);
                if (activepoints.length > 0) {
                    var clickedIndex = activepoints[0]["_index"];
                    var tipo = tipoTecnico.data.labels[clickedIndex];
                    window.location.href = "{% url 'lattes:producoes' %}?tipo__contains=" + tipo
                }
                else {
                }
            }
        );
	});
</script>
<script>
	document.addEventListener("DOMContentLoaded", function() {
		var tipoOrientacao = new Chart(document.getElementById('ChartOrientacao'), {
            type: 'bar',
            data: {
                labels: {% autoescape off %}{{ tiposO }}{% endautoescape %},
                datasets: [{
                    label: '# de Produção',
                    data: {{ totalTipoO }},
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }],
            },
            options: {
                title: { display: true, text: 'Distribuição por tipo de produção orientação em andamento' },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                }
            }
        });
        $("#ChartOrientacao").click(
            function (event) {
                var activepoints = tipoOrientacao.getElementsAtEvent(event);
                if (activepoints.length > 0) {
                    var clickedIndex = activepoints[0]["_index"];
                    var tipo = tipoOrientacao.data.labels[clickedIndex];
                    window.location.href = "{% url 'lattes:producoes' %}?tipo__contains=" + tipo
                }
                else {
                }
            }
        );	
	});
</script>
<script>
	document.addEventListener("DOMContentLoaded", function() {
        var tipoArtistico = new Chart(document.getElementById('ChartArtistico'), {
            type: 'bar',
            data: {
                labels: {% autoescape off %}{{ tiposA }}{% endautoescape %},
                datasets: [{
                    label: '# de Produção',
                    data: {{ totalTipoA }},
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                title: { display: true, text: 'Distribuição por tipo de produção artística/cultural' },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                }
            }
        });
        $("#ChartArtistico").click(
            function (event) {
                var activepoints = tipoArtistico.getElementsAtEvent(event);
                if (activepoints.length > 0) {
                    var clickedIndex = activepoints[0]["_index"];
                    var tipo = tipoArtistico.data.labels[clickedIndex];
                    window.location.href = "{% url 'lattes:producoes' %}?tipo__contains=" + tipo
                }
                else {
                }
            }
        );
	});
</script>
<script>
	document.addEventListener("DOMContentLoaded", function() {
        var tipoEvento = new Chart(document.getElementById('ChartEvento'), {
            type: 'bar',
            data: {
                labels: {% autoescape off %}{{ tiposE }}{% endautoescape %},
                datasets: [{
                    label: '# de Produção',
                    data: {{ totalTipoE }},
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                title: { display: true, text: 'Distribuição por tipo de produção banca, evento ou outro tipo de produção' },
            }
        });
        $("#ChartEvento").click(
            function (event) {
                var activepoints = tipoEvento.getElementsAtEvent(event);
                if (activepoints.length > 0) {
                    var clickedIndex = activepoints[0]["_index"];
                    var tipo = tipoEvento.data.labels[clickedIndex];
                    window.location.href = "{% url 'lattes:producoes' %}?tipo__contains=" + tipo
                }
                else {
                }
            }
        );
	});
</script>
{% endblock %}
{% block aside %}
<h2><i class="fas fa-search"></i> Filtros</h2>
<form method="GET">
    <div id="filtroTitulo">
        <div class="drop-bnt">
            <h3>Titulo <i class="fas fa-caret-down"></i></h3>
        </div>
        <div class="wrapper">
            <p>Titulo:{{producoes_filtradas.form.titulo__contains}}</p>
        </div>
    </div>
    <div id="filtroTipo">
        <div class="drop-bnt">
            <h3>Tipo <i class="fa fa-caret-down"></i></h3>
        </div>
        <div class="wrapper">
            <p>Tipo:{{producoes_filtradas.form.tipo__contains}}</p>
        </div>
    </div>
    <div id="filtroAno">
        <div class="drop-bnt">
            <h3>Ano Produção <i class="fas fa-caret-down"></i></h3>
        </div>
        <div class="wrapper">
            <p>Ano partir de: {{producoes_filtradas.form.ano__gte}} até:
                {{producoes_filtradas.form.ano__lte}}</p>
        </div>
    </div>
    <div id="filtroInformadoPor">
        <div class="drop-bnt">
            <h3>Informado Por <i class="fas fa-caret-down"></i></h3>
        </div>
        <div class="wrapper">
            <p>informado por:{{producoes_filtradas.form.informadoPor__contains}}</p>
        </div>
    </div>
    <input type="submit" value="Buscar">
    <a href="?" class="botao">Limpar</a>
</form>
<script>
    function f(element, index) {
        element.onclick = (() => {
            wrapper[index].classList.toggle("show");
        });
    }
    const list = document.querySelectorAll('.drop-bnt').forEach(f);
    const wrapper = document.querySelectorAll(".wrapper");
</script>
{% endblock %}